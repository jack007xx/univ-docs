# 記憶階層
- 主記憶
  - RAM
  - 高速アクセス、効果、揮発性
- 二次記憶
  - 磁気ディスクorフラッシュメモリ
  - HDD、SDD
  - 不揮発
- 三次記憶
  - 磁気テープ
  - 大量のデータが入れれる
  - シーケンシャルアクセスが必要、めっちゃ遅い

## 磁気ディスクの構造
- トラック
  - 円盤状の同心円
- セクタ
  - トラック上の区画で記録の単位
- ページ(ブロック)
  - 複数の連続するセクタでの読み書きの単位

### RAID
複数のディスクを組み合わせて、高速化、冗長性の確保

## フラッシュメモリ
- 不揮発性メモリ
  - NVRAM
- NOR型
  - 読み取りが高速、ランダムアクセス可能
  - 携帯機器とか
- NAND型
  - 書き消しの性能が良い
  - 密度高い、低コスト
  - SSD

# レコードとファイル
- レコード
  - リレーションのタプルの内部表現
  - フィールド
    - タプルの属性値によって複数個存在
- ファイル
  - 関連するレコードを組織化
  - OSのファイルとは違う

## レコードの管理方式
ディスクのあるページに連続領域に割当。

## レコードの分類
- 固定長レコード
  - サイズ一定
  - ミッチミチに格納できる
- 可変長レコード
  - サイズ可変
  - 管理が複雑

## ファイル編成
レコードをページに割り当てる方式

代表的なもの
- ヒープファイル
- ハッシュファイル
- 索引付きファイル
- B木、B+木
- 二次索引

キー：フィールドの組み合わせのうち、レコードの位置決めに用いるもの

### ヒープファイル
ページ内にレコードを順次格納したもの
- 挿入
  - ページに空きがあれば追加
  - なければ新規ページ
- 削除
  - ページ内でレコードを削除
- 特徴
  - 格納効率はいい
  - キーを用いたレコード検索がムリ

オフセット情報を格納したスロットからなるディレクトリを使用。
ページ：ディレクトリ→←レコードみたいに両端から埋めていく。

### 順次ファイル(ソート済ファイル)
ファイルを構成するページに、レコードをキー値順に格納。
順序付けフィールド：レコード順序を決める。

- 順序付けフィールドの順序で読み出し可能
- ランダムアクセス系は苦手
- データ挿入もむずい

### ハッシュファイル
レコードのキー値をハッシュ関数でハッシュして、格納先のバケットを決定
- バケット
  - 一つ以上の連続したページ
- バケットディレクトリ
  - バケットのアドレスを格納
  - ハッシュ値→バケットの対応を取る
  
挿入時にバケット空きがないときは、オーバーフロー処理をする。
末尾に他のバケットへのリンク入れたり、再ハッシュしたり。

範囲検索とか、キー値順でのレコード読み出しには対応してない。

### 索引付きファイル
- データ部
  - 1連のページに、レコードをキー値順に格納
- 索引部
  - 索引ページに、索引レコードを順に格納
  - データページ中の先頭レコードのキー値と、そのページへのポインタというペア
    - 先頭だけ!!

新しいレコードを挿入するコストは高い。

## B木
動的な挿入削除に適した編成法。DBだと発展のB+木がよく使われる。

d次のB木は、各ノードがd<=i<=2dとしてi個のレコードをもつ(ルートは1<=i<=2d)。
挿入削除アルゴリズムは教科書参照。

### 利点
動的に構成できて、動的に再構成できる。
高速にアクセスできる。
空間効率が比較的いい。(最低50%)

## B+木
B木は主記憶、B+木は二次記憶に対応する。

### B木との相違点
- レコードはリーフノードにのみ、非リーフノードにはキー値のみを格納
- 検索はリーフノードまでたどる必要がある

### 構成
- 索引部
  - キー値が入ること以外はB木と一緒
- データ部
  - パラメータに対して、e/2の天井以上、e以下のレコードを持つ
  - リーフノード同士を結ぶ横方向のポインタを持つ

キー値の順で読み出すには、リーフノードを順番に読むだけでいい。
範囲検索も先頭を検索して、そこから末尾までたどる。

### 利点
B木の利点を受け継いでる。
- 範囲検索とかを、効率よく処理できる。
- キー値のみが挿入されるので、より多くのキー値を収容できる。
  - 横広がりで、高さを低くすることができる。
